# http://wordpress.stackexchange.com/questions/235879/whats-the-fastest-way-least-amount-of-steps-to-locally-import-a-remote-databa/236051#236051

pullprod() {
    START=$(date +%s)
    # make a backup of the current local database
    wp db export _db.sql
    wp db reset --yes
    # get current directory name, used for database and URL
    current=${PWD##*/}
    # connect to remote site and export the remote database down to our local directory
    wp @prod db export - > $current.sql
    echo "rsync of remote database to $current directory complete."
    wp db import
    # database is now imported so delete it
    rm -rf $current.sql
    # update everything
    wp plugin update --all
    wp theme update --all
    wp core update
    # deactivate plugins that aren't needed
    wp plugin deactivate google-universal-analytics worker wp-rocket
    # activate plugins used for development
    wp plugin activate debug-bar query-monitor acf-theme-code-pro
    # get the remote site URL, remove the http:// for our search replace
    production_url=$(wp @prod eval '$full_url=get_site_url();$trimmed_url=str_replace("http://", "", $full_url); echo $trimmed_url;')
    wp search-replace "$production_url" "$current.localhost" --all-tables
    END=$(date +%s)
    DIFF=$(( $END - $START ))
    echo -e "\n$production_url database now in use on $current.localhost site.\nIt took $DIFF seconds, enjoy!\n"
}